<!DOCTYPE html>
<html lang="en">
<head>
<title>Assemblyscript Structs</title>
<style>
  body {
    font-family: sans-serif;
    padding: 20px;
  }
</style>
</head>
<body>
  <p>This is a very simple test of passing C-structs to/from assemblyscript. You can read more <a href="https://github.com/konsumer/as_structs">here</a></p>
  <ul id="ul"></ul>
</body>
<script type="module">
import * as w from "./build/debug.js"

const ul = document.getElementById('ul')

const out = [`Basic add: 1+2=${w.add(1, 2)}`]

// View for WebAssembly memory, can be shared across the host
const v = new DataView(w.memory.buffer)

// Setup param (allocate 4 bytes for the Vector struct)
const pi = w.malloc(4)

// Set the values for x and y at the correct byte offsets (pi and pi + 2)
v.setUint16(pi, 100, true) // Set x = 100 at pi (little-endian)
v.setUint16(pi + 2, 200, true) // Set y = 200 at pi + 2 (little-endian)

// Call the test function
const po = w.test(pi) // Get the pointer to the copied struct

out.push(`Input: Vector(${v.getUint16(pi, true)}x${v.getUint16(pi + 2, true)})`)
out.push(`Output (add 100): Vector(${v.getUint16(po, true)}x${v.getUint16(po + 2, true)})`)

// Free the allocated memory
w.free(pi)
w.free(po)

// output display-list
for (let s of out) {
  const li = document.createElement("li")
  li.textContent = s
  ul.appendChild(li)
}

</script>
</html>
